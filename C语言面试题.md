# C语言常见题目

# volatile 常见的几个面试题--2019.3.4
### 1. 一个参数既可以是const还可以是volatile吗？

	可以，例如只读的状态寄存器。它是 volatile 因为它可能被意想不到地改变。它是 const 因为程序不应该试图去修改它。
	
### 2. 一个指针可以是 volatile 吗？

	可以，当一个中服务子程序修改一个指向一个 buffer 的指针时。
	
### 3.下面的函数有什么错误： 
```C
int square(volatile int *ptr) 
{ 
    return *ptr * *ptr; 
} 
```

这段代码的目的是用来返指针*ptr指向值的平方，但是，由于*ptr指向一个volatile型参数，编译器将产生类似下面的代码：
```C
int square(volatile int *ptr)  
{ 
	 int a,b; 
	 a = *ptr; 
	 b = *ptr; 
	 return a * b; 
}
```
由于*ptr的值可能被意想不到地该变，因此a和b可能是不同的。结果，这段代码可能返不是你所期望的平方值！正确的代码如下： 

```C
long square(volatile int *ptr)  
{ 
    int a; 
    a = *ptr; 
    return a * a; 
}
```
## 总结：
一般来说，volatile用在如下的几个地方：   
* 中断服务程序中修改的供其它程序检测的变量需要加volatile；   
* 多任务环境下各任务间共享的标志应该加volatile；   
* 存储器映射的硬件寄存器通常也要加volatile说明，因为每次对它的读写都可能由不同意义； 

**volatile关键字是一种类型修饰符，用它声明的类型变量表示可以被某些编译器未知的因素更改**。volatile提醒编译器它后面所定义的变量随时都有可能改变，因此编译后的程序每次需要存储或读取这个变量的时候，都会**直接从变量地址中读取数据** 。如果没有volatile关键字，则编译器可能优化读取和存储，可能暂时使用寄存器中的值，如果这个变量由别的程序更新了的话，将出现不一致的现象。所以**遇到这个关键字声明的变量，编译器对访问该变量的代码就不再进行优化，从而可以提供对特殊地址的稳定访问** 。

--------------------- 
